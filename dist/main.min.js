(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/erikrekola/Awesome/GrannySlalom/src/js/entities/boost.js":[function(require,module,exports){
var Boost = function (game, x, y) {
    Phaser.Sprite.call(this, game, x, y, 'runner');
    game.add.existing(this);
    game.physics.enable(this, Phaser.Physics.ARCADE);
    this.anchor.setTo(0.5, 0.5);
    this.animations.add('idle', [15]);
    this.animations.play('idle');
    this.body.setSize(90, 40, 0, 0);
}

Boost.prototype = Object.create(Phaser.Sprite.prototype);
Boost.prototype.constructor = Boost;

/**
 * Automatically called by World.update
 */
Boost.prototype.update = function () {

};

module.exports = Boost;

},{}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/entities/gramma.js":[function(require,module,exports){
var Gramma = function (game, x, y) {
    Phaser.Sprite.call(this, game, x, y, 'gramma');
    game.add.existing(this);
    game.physics.enable(this, Phaser.Physics.ARCADE);
    this.scale.set(1);
    this.anchor.setTo(0.5, 0.5);
    this.smoothed = false;
    this.animations.add('run');
    this.animations.play('run', 10, true);
    this.body.bounce.setTo(1, 1);
    this.body.setSize(120, 40, 0, 60);
    this.body.immovable = true;
    this.body.collideWorldBounds = false;
    this.checkWorldBounds = true;
    this.direction = Math.round(Math.random() * 1);
}

Gramma.prototype = Object.create(Phaser.Sprite.prototype);
Gramma.prototype.constructor = Gramma;

/**
 * Automatically called by World.update
 */
Gramma.prototype.update = function () {

    this.z = this.position.y;

    // Add speed to gramma
    this.body.velocity.y = 150;

    if (this.direction == 1) {
        this.body.velocity.x = Math.random() * 50;
    } else {
        this.body.velocity.x = Math.random() * -50;
    }

    // Remove the gramma when it leaves the screen
    if (this.position.y < this.game.camera.y) {
        this.kill();
    }
};

module.exports = Gramma;

},{}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/entities/player.js":[function(require,module,exports){
var Player = function (game, x, y) {
    Phaser.Sprite.call(this, game, x, y, 'runner');
    game.add.existing(this);
    game.physics.enable(this, Phaser.Physics.ARCADE);
    this.anchor.setTo(0.5, 0.5);
    this.smoothed = false;
    this.animations.add('run', [0,1,2,3,4,5]);
    this.animations.add('walk', [6,7,8,9,10]);
    this.animations.add('sprint', [11,12,13,14]);
    this.body.bounce.setTo(0, 0);
    this.body.setSize(40, 40, 0, 40);
    this.body.maxVelocity = new Phaser.Point(1000, 2000);
    this.body.collideWorldBounds = true;
    this.mass = 2;
    this.body.velocity.y = 250;
    this.speedBoost = false;
};

Player.prototype = Object.create(Phaser.Sprite.prototype);
Player.prototype.constructor = Player;

/**
 * Automatically called by World.update
 */
Player.prototype.update = function () {

    var animationSpeed = Math.ceil(this.body.velocity.y / 40);

    if (this.body.velocity.y > 1000) {
        this.animations.play('sprint', animationSpeed, true);
    } else if (this.body.velocity.y > 500) {
        this.animations.play('run', animationSpeed, true);
    } else {
        this.animations.play('walk', animationSpeed, true);
    }

    this.animations.currentAnim.speed = animationSpeed;

    this.z = this.position.y;

    // Add speed to runner
    //if (this.speedBoost === true) {
    //    this.body.velocity.y = 1500;
    //}

    this.body.velocity.y += 10 - (this.body.velocity.y / 10000);

};

Player.prototype.collectBoost = function () {
    this.body.velocity.y = 1500;
    // this.speedBoost = true;
}

Player.prototype.endBoost = function () {
    this.speedBoost = false;
}


module.exports = Player;

},{}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(360, 640, Phaser.AUTO, 'grannyslalom-game');

window.Utils = require('./utils');
window.playerState = {
    currentLevel: 'Game',
    scores:[]
}

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));
game.state.add('Score', require('./states/score'));
game.state.add('Win', require('./states/win'));
game.state.add('Lose', require('./states/lose'));

game.state.start('Boot');

},{"./states/boot":"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/boot.js","./states/game":"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/game.js","./states/lose":"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/lose.js","./states/menu":"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/menu.js","./states/preloader":"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/preloader.js","./states/score":"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/score.js","./states/splash":"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/splash.js","./states/win":"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/win.js","./utils":"/Users/erikrekola/Awesome/GrannySlalom/src/js/utils.js"}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/boot.js":[function(require,module,exports){
var Boot = function () {
};

module.exports = Boot;

Boot.prototype = {

    preload: function () {
        this.load.image('preloader', 'assets/preloader.gif');
    },

    create: function () {
        this.game.input.maxPointers = 1;

        this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;

        this.game.state.start('Preloader');
    }
};

},{}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/game.js":[function(require,module,exports){
var Player = require('../entities/player');
var Gramma = require('../entities/gramma');
var Boost = require('../entities/boost');

var Game = function () {
    this.runner = null;
    this.land = null;
    this.grammas = null;
    this.nextGramma = null;
    this.timer = 0;
    this.stageLength = 60 * 500;
    this.boosts = null;
    this.runTimer = null;
};

module.exports = Game;

Game.prototype = {

    create: function () {

        this.world.setBounds(0, 0, 360, this.stageLength);

        this.physics.startSystem(Phaser.Physics.ARCADE);

        this.land = this.add.tileSprite(0, 0, 360, 640, 'floortile');
        this.land.scale.set(2);
        this.land.smoothed = false;
        this.land.fixedToCamera = true;

        this.runner = new Player(this.game, 360/2, 200);
        this.grammas = this.add.group();

        this.camera.follow(this.runner);
        this.camera.deadzone = new Phaser.Rectangle(0, 0, 360, 250);

        this.nextGramma = 640;

        this.runTimer = this.time.events.add(Phaser.Timer.SECOND * 60, this.endGame, this);
        this.timer = this.game.add.text(this.world.centerX, 0, "60");
        this.timer.fixedToCamera = true;

        this.timer.anchor.set(0.5, 0);

        // Drop a boost on the level
        this.boosts = this.add.group();

        var boost = new Boost(this.game, 360/2, 600);

        this.boosts.add(boost);

    },

    update: function () {

        // scroll the screen
        this.camera.y += 6;

        var timeLeft = Math.floor(this.runTimer.timer.duration / 1000);
        var distanceLeft = this.stageLength - this.camera.y - 640;

        this.timer.setText(timeLeft + ' || ' + distanceLeft);

        this.physics.arcade.collide(this.runner, this.grammas);
        this.physics.arcade.collide(this.runner, this.boosts, this.collectBoost, null, this);

        this.runner.body.velocity.x = 0;

        // Key press to right
        if (this.input.keyboard.isDown(Phaser.Keyboard.RIGHT)) {
            this.runner.body.velocity.x = + 300;
        }

        // Key press to left
        if (this.input.keyboard.isDown(Phaser.Keyboard.LEFT)) {
            this.runner.body.velocity.x = - 300;
        }

        this.grammas.sort('y', Phaser.Group.SORT_ASCENDING);

        // the ammount is halved due to scaling
        this.land.tilePosition.x = -this.camera.x / 2;
        this.land.tilePosition.y = -this.camera.y / 2;

        if (this.camera.y > this.nextGramma) {
            this.addGramma();
        }

        // If he falls behind too much you lose
        if (this.runner.position.y <= this.camera.y) {
            this.endGame();
        }

        // When you get to the end you win
        if (distanceLeft == 0) {
            this.endGame(true);
        }
    },

    render: function () {
        // this.game.debug.bodyInfo(this.runner, 32, 32);
        // this.game.debug.body(this.runner, 32, 32);
    },

    addGramma: function () {
        var gramma = new Gramma(
            this.game,
            Math.random() * 360,
            this.camera.y + 640
        );

        // this.game.debug.body(gramma);
        this.grammas.add(gramma);
        this.nextGramma+= 320;
    },

    endGame: function (win) {
        var score = 0;

        if (win) {
            this.game.state.start('Win');
            score = Math.round(this.time.events.duration / 100);
            window.playerState.scores.push(score);
        } else {
            this.game.state.start('Lose');
        }
    },

    collectBoost: function (runner, boost) {
        boost.kill();
        this.runner.collectBoost();
        // this.time.events.add(Phaser.Timer.SECOND * 10, this.runner.endBoost);
    }
};

},{"../entities/boost":"/Users/erikrekola/Awesome/GrannySlalom/src/js/entities/boost.js","../entities/gramma":"/Users/erikrekola/Awesome/GrannySlalom/src/js/entities/gramma.js","../entities/player":"/Users/erikrekola/Awesome/GrannySlalom/src/js/entities/player.js"}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/lose.js":[function(require,module,exports){
var Lose = function () {
};

module.exports = Lose;

Lose.prototype = {
    create: function () {
        var style = {font: "24px Arial", fill: "#ffffff", align: "center"},
            text = this.add.text(this.world.centerX, 200, "You Lose", style);

        text.anchor.set(0.5, 0);

        this.input.onDown.add(this.onDown, this);
    },

    onDown: function () {
        this.game.state.start('Menu');
    }
};
},{}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/menu.js":[function(require,module,exports){
var Menu = function () {
    this.text = null;
};

module.exports = Menu;

Menu.prototype = {

    create: function () {
        var style = {font: "24px Arial", fill: "#ffffff", align: "center"},
            text = this.add.text(this.world.centerX, 200, "Press to Start", style);

        this.stage.backgroundColor = "#000000";

        text.anchor.set(0.5, 0);

        this.input.onDown.add(this.onDown, this);
    },

    update: function () {
    },

    onDown: function () {
        this.game.state.start(playerState.currentLevel);
        // this.game.state.start('Win');
    }
};

},{}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/preloader.js":[function(require,module,exports){
var Preloader = function (game) {
    this.asset = null;
    this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

    preload: function () {
        this.asset = this.add.sprite(320, 240, 'preloader');
        this.asset.anchor.setTo(0.5, 0.5);

        this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
        this.load.setPreloadSprite(this.asset);
        this.load.image('floortile', 'assets/floortile.png');
        this.load.spritesheet('runner', 'assets/runner.png', 120, 120);
        this.load.spritesheet('gramma', 'assets/gramma.png', 120, 120);

    },

    create: function () {
        this.asset.cropEnabled = false;
    },

    update: function () {
        if (!!this.ready) {
            this.game.state.start('Menu');
        }
    },

    onLoadComplete: function () {
        this.ready = true;
    }
};

},{}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/score.js":[function(require,module,exports){
var Score = function () {
};

module.exports = Score;

Score.prototype = {
    create: function () {

    }
};
},{}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
    create: function () {
    }
};
},{}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/states/win.js":[function(require,module,exports){
var Win = function () {
};

module.exports = Win;

Win.prototype = {
    create: function () {
        var lastScore = window.playerState.scores[window.playerState.scores.length-1],
            style = {font: "24px Arial", fill: "#ffffff", align: "center"},
            text = this.add.text(this.world.centerX, 200, "You win " + lastScore, style);

        text.anchor.set(0.5, 0);

        this.input.onDown.add(this.onDown, this);
    },

    onDown: function () {
        this.game.state.start('Menu');
    }
};
},{}],"/Users/erikrekola/Awesome/GrannySlalom/src/js/utils.js":[function(require,module,exports){
var Utils = {
    containsObject: function (obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    }
};

module.exports = Utils;
},{}]},{},["/Users/erikrekola/Awesome/GrannySlalom/src/js/main.js"])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvZW50aXRpZXMvYm9vc3QuanMiLCJzcmMvanMvZW50aXRpZXMvZ3JhbW1hLmpzIiwic3JjL2pzL2VudGl0aWVzL3BsYXllci5qcyIsInNyYy9qcy9tYWluLmpzIiwic3JjL2pzL3N0YXRlcy9ib290LmpzIiwic3JjL2pzL3N0YXRlcy9nYW1lLmpzIiwic3JjL2pzL3N0YXRlcy9sb3NlLmpzIiwic3JjL2pzL3N0YXRlcy9tZW51LmpzIiwic3JjL2pzL3N0YXRlcy9wcmVsb2FkZXIuanMiLCJzcmMvanMvc3RhdGVzL3Njb3JlLmpzIiwic3JjL2pzL3N0YXRlcy9zcGxhc2guanMiLCJzcmMvanMvc3RhdGVzL3dpbi5qcyIsInNyYy9qcy91dGlscy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJ2YXIgQm9vc3QgPSBmdW5jdGlvbiAoZ2FtZSwgeCwgeSkge1xuICAgIFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCAncnVubmVyJyk7XG4gICAgZ2FtZS5hZGQuZXhpc3RpbmcodGhpcyk7XG4gICAgZ2FtZS5waHlzaWNzLmVuYWJsZSh0aGlzLCBQaGFzZXIuUGh5c2ljcy5BUkNBREUpO1xuICAgIHRoaXMuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcbiAgICB0aGlzLmFuaW1hdGlvbnMuYWRkKCdpZGxlJywgWzE1XSk7XG4gICAgdGhpcy5hbmltYXRpb25zLnBsYXkoJ2lkbGUnKTtcbiAgICB0aGlzLmJvZHkuc2V0U2l6ZSg5MCwgNDAsIDAsIDApO1xufVxuXG5Cb29zdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKTtcbkJvb3N0LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEJvb3N0O1xuXG4vKipcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxuICovXG5Cb29zdC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xuXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJvb3N0O1xuIiwidmFyIEdyYW1tYSA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5KSB7XG4gICAgUGhhc2VyLlNwcml0ZS5jYWxsKHRoaXMsIGdhbWUsIHgsIHksICdncmFtbWEnKTtcbiAgICBnYW1lLmFkZC5leGlzdGluZyh0aGlzKTtcbiAgICBnYW1lLnBoeXNpY3MuZW5hYmxlKHRoaXMsIFBoYXNlci5QaHlzaWNzLkFSQ0FERSk7XG4gICAgdGhpcy5zY2FsZS5zZXQoMSk7XG4gICAgdGhpcy5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuICAgIHRoaXMuc21vb3RoZWQgPSBmYWxzZTtcbiAgICB0aGlzLmFuaW1hdGlvbnMuYWRkKCdydW4nKTtcbiAgICB0aGlzLmFuaW1hdGlvbnMucGxheSgncnVuJywgMTAsIHRydWUpO1xuICAgIHRoaXMuYm9keS5ib3VuY2Uuc2V0VG8oMSwgMSk7XG4gICAgdGhpcy5ib2R5LnNldFNpemUoMTIwLCA0MCwgMCwgNjApO1xuICAgIHRoaXMuYm9keS5pbW1vdmFibGUgPSB0cnVlO1xuICAgIHRoaXMuYm9keS5jb2xsaWRlV29ybGRCb3VuZHMgPSBmYWxzZTtcbiAgICB0aGlzLmNoZWNrV29ybGRCb3VuZHMgPSB0cnVlO1xuICAgIHRoaXMuZGlyZWN0aW9uID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMSk7XG59XG5cbkdyYW1tYS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKTtcbkdyYW1tYS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBHcmFtbWE7XG5cbi8qKlxuICogQXV0b21hdGljYWxseSBjYWxsZWQgYnkgV29ybGQudXBkYXRlXG4gKi9cbkdyYW1tYS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgdGhpcy56ID0gdGhpcy5wb3NpdGlvbi55O1xuXG4gICAgLy8gQWRkIHNwZWVkIHRvIGdyYW1tYVxuICAgIHRoaXMuYm9keS52ZWxvY2l0eS55ID0gMTUwO1xuXG4gICAgaWYgKHRoaXMuZGlyZWN0aW9uID09IDEpIHtcbiAgICAgICAgdGhpcy5ib2R5LnZlbG9jaXR5LnggPSBNYXRoLnJhbmRvbSgpICogNTA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5ib2R5LnZlbG9jaXR5LnggPSBNYXRoLnJhbmRvbSgpICogLTUwO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSB0aGUgZ3JhbW1hIHdoZW4gaXQgbGVhdmVzIHRoZSBzY3JlZW5cbiAgICBpZiAodGhpcy5wb3NpdGlvbi55IDwgdGhpcy5nYW1lLmNhbWVyYS55KSB7XG4gICAgICAgIHRoaXMua2lsbCgpO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gR3JhbW1hO1xuIiwidmFyIFBsYXllciA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5KSB7XG4gICAgUGhhc2VyLlNwcml0ZS5jYWxsKHRoaXMsIGdhbWUsIHgsIHksICdydW5uZXInKTtcbiAgICBnYW1lLmFkZC5leGlzdGluZyh0aGlzKTtcbiAgICBnYW1lLnBoeXNpY3MuZW5hYmxlKHRoaXMsIFBoYXNlci5QaHlzaWNzLkFSQ0FERSk7XG4gICAgdGhpcy5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuICAgIHRoaXMuc21vb3RoZWQgPSBmYWxzZTtcbiAgICB0aGlzLmFuaW1hdGlvbnMuYWRkKCdydW4nLCBbMCwxLDIsMyw0LDVdKTtcbiAgICB0aGlzLmFuaW1hdGlvbnMuYWRkKCd3YWxrJywgWzYsNyw4LDksMTBdKTtcbiAgICB0aGlzLmFuaW1hdGlvbnMuYWRkKCdzcHJpbnQnLCBbMTEsMTIsMTMsMTRdKTtcbiAgICB0aGlzLmJvZHkuYm91bmNlLnNldFRvKDAsIDApO1xuICAgIHRoaXMuYm9keS5zZXRTaXplKDQwLCA0MCwgMCwgNDApO1xuICAgIHRoaXMuYm9keS5tYXhWZWxvY2l0eSA9IG5ldyBQaGFzZXIuUG9pbnQoMTAwMCwgMjAwMCk7XG4gICAgdGhpcy5ib2R5LmNvbGxpZGVXb3JsZEJvdW5kcyA9IHRydWU7XG4gICAgdGhpcy5tYXNzID0gMjtcbiAgICB0aGlzLmJvZHkudmVsb2NpdHkueSA9IDI1MDtcbiAgICB0aGlzLnNwZWVkQm9vc3QgPSBmYWxzZTtcbn07XG5cblBsYXllci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKTtcblBsYXllci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQbGF5ZXI7XG5cbi8qKlxuICogQXV0b21hdGljYWxseSBjYWxsZWQgYnkgV29ybGQudXBkYXRlXG4gKi9cblBsYXllci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIGFuaW1hdGlvblNwZWVkID0gTWF0aC5jZWlsKHRoaXMuYm9keS52ZWxvY2l0eS55IC8gNDApO1xuXG4gICAgaWYgKHRoaXMuYm9keS52ZWxvY2l0eS55ID4gMTAwMCkge1xuICAgICAgICB0aGlzLmFuaW1hdGlvbnMucGxheSgnc3ByaW50JywgYW5pbWF0aW9uU3BlZWQsIHRydWUpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5ib2R5LnZlbG9jaXR5LnkgPiA1MDApIHtcbiAgICAgICAgdGhpcy5hbmltYXRpb25zLnBsYXkoJ3J1bicsIGFuaW1hdGlvblNwZWVkLCB0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmFuaW1hdGlvbnMucGxheSgnd2FsaycsIGFuaW1hdGlvblNwZWVkLCB0cnVlKTtcbiAgICB9XG5cbiAgICB0aGlzLmFuaW1hdGlvbnMuY3VycmVudEFuaW0uc3BlZWQgPSBhbmltYXRpb25TcGVlZDtcblxuICAgIHRoaXMueiA9IHRoaXMucG9zaXRpb24ueTtcblxuICAgIC8vIEFkZCBzcGVlZCB0byBydW5uZXJcbiAgICAvL2lmICh0aGlzLnNwZWVkQm9vc3QgPT09IHRydWUpIHtcbiAgICAvLyAgICB0aGlzLmJvZHkudmVsb2NpdHkueSA9IDE1MDA7XG4gICAgLy99XG5cbiAgICB0aGlzLmJvZHkudmVsb2NpdHkueSArPSAxMCAtICh0aGlzLmJvZHkudmVsb2NpdHkueSAvIDEwMDAwKTtcblxufTtcblxuUGxheWVyLnByb3RvdHlwZS5jb2xsZWN0Qm9vc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5ib2R5LnZlbG9jaXR5LnkgPSAxNTAwO1xuICAgIC8vIHRoaXMuc3BlZWRCb29zdCA9IHRydWU7XG59XG5cblBsYXllci5wcm90b3R5cGUuZW5kQm9vc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zcGVlZEJvb3N0ID0gZmFsc2U7XG59XG5cblxubW9kdWxlLmV4cG9ydHMgPSBQbGF5ZXI7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBnYW1lID0gbmV3IFBoYXNlci5HYW1lKDM2MCwgNjQwLCBQaGFzZXIuQVVUTywgJ2dyYW5ueXNsYWxvbS1nYW1lJyk7XG5cbndpbmRvdy5VdGlscyA9IHJlcXVpcmUoJy4vdXRpbHMnKTtcbndpbmRvdy5wbGF5ZXJTdGF0ZSA9IHtcbiAgICBjdXJyZW50TGV2ZWw6ICdHYW1lJyxcbiAgICBzY29yZXM6W11cbn1cblxuZ2FtZS5zdGF0ZS5hZGQoJ0Jvb3QnLCByZXF1aXJlKCcuL3N0YXRlcy9ib290JykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1NwbGFzaCcsIHJlcXVpcmUoJy4vc3RhdGVzL3NwbGFzaCcpKTtcbmdhbWUuc3RhdGUuYWRkKCdQcmVsb2FkZXInLCByZXF1aXJlKCcuL3N0YXRlcy9wcmVsb2FkZXInKSk7XG5nYW1lLnN0YXRlLmFkZCgnTWVudScsIHJlcXVpcmUoJy4vc3RhdGVzL21lbnUnKSk7XG5nYW1lLnN0YXRlLmFkZCgnR2FtZScsIHJlcXVpcmUoJy4vc3RhdGVzL2dhbWUnKSk7XG5nYW1lLnN0YXRlLmFkZCgnU2NvcmUnLCByZXF1aXJlKCcuL3N0YXRlcy9zY29yZScpKTtcbmdhbWUuc3RhdGUuYWRkKCdXaW4nLCByZXF1aXJlKCcuL3N0YXRlcy93aW4nKSk7XG5nYW1lLnN0YXRlLmFkZCgnTG9zZScsIHJlcXVpcmUoJy4vc3RhdGVzL2xvc2UnKSk7XG5cbmdhbWUuc3RhdGUuc3RhcnQoJ0Jvb3QnKTtcbiIsInZhciBCb290ID0gZnVuY3Rpb24gKCkge1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBCb290O1xuXG5Cb290LnByb3RvdHlwZSA9IHtcblxuICAgIHByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL3ByZWxvYWRlci5naWYnKTtcbiAgICB9LFxuXG4gICAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZ2FtZS5pbnB1dC5tYXhQb2ludGVycyA9IDE7XG5cbiAgICAgICAgdGhpcy5nYW1lLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuU0hPV19BTEw7XG5cbiAgICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdQcmVsb2FkZXInKTtcbiAgICB9XG59O1xuIiwidmFyIFBsYXllciA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL3BsYXllcicpO1xudmFyIEdyYW1tYSA9IHJlcXVpcmUoJy4uL2VudGl0aWVzL2dyYW1tYScpO1xudmFyIEJvb3N0ID0gcmVxdWlyZSgnLi4vZW50aXRpZXMvYm9vc3QnKTtcblxudmFyIEdhbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5ydW5uZXIgPSBudWxsO1xuICAgIHRoaXMubGFuZCA9IG51bGw7XG4gICAgdGhpcy5ncmFtbWFzID0gbnVsbDtcbiAgICB0aGlzLm5leHRHcmFtbWEgPSBudWxsO1xuICAgIHRoaXMudGltZXIgPSAwO1xuICAgIHRoaXMuc3RhZ2VMZW5ndGggPSA2MCAqIDUwMDtcbiAgICB0aGlzLmJvb3N0cyA9IG51bGw7XG4gICAgdGhpcy5ydW5UaW1lciA9IG51bGw7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWU7XG5cbkdhbWUucHJvdG90eXBlID0ge1xuXG4gICAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgdGhpcy53b3JsZC5zZXRCb3VuZHMoMCwgMCwgMzYwLCB0aGlzLnN0YWdlTGVuZ3RoKTtcblxuICAgICAgICB0aGlzLnBoeXNpY3Muc3RhcnRTeXN0ZW0oUGhhc2VyLlBoeXNpY3MuQVJDQURFKTtcblxuICAgICAgICB0aGlzLmxhbmQgPSB0aGlzLmFkZC50aWxlU3ByaXRlKDAsIDAsIDM2MCwgNjQwLCAnZmxvb3J0aWxlJyk7XG4gICAgICAgIHRoaXMubGFuZC5zY2FsZS5zZXQoMik7XG4gICAgICAgIHRoaXMubGFuZC5zbW9vdGhlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmxhbmQuZml4ZWRUb0NhbWVyYSA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5ydW5uZXIgPSBuZXcgUGxheWVyKHRoaXMuZ2FtZSwgMzYwLzIsIDIwMCk7XG4gICAgICAgIHRoaXMuZ3JhbW1hcyA9IHRoaXMuYWRkLmdyb3VwKCk7XG5cbiAgICAgICAgdGhpcy5jYW1lcmEuZm9sbG93KHRoaXMucnVubmVyKTtcbiAgICAgICAgdGhpcy5jYW1lcmEuZGVhZHpvbmUgPSBuZXcgUGhhc2VyLlJlY3RhbmdsZSgwLCAwLCAzNjAsIDI1MCk7XG5cbiAgICAgICAgdGhpcy5uZXh0R3JhbW1hID0gNjQwO1xuXG4gICAgICAgIHRoaXMucnVuVGltZXIgPSB0aGlzLnRpbWUuZXZlbnRzLmFkZChQaGFzZXIuVGltZXIuU0VDT05EICogNjAsIHRoaXMuZW5kR2FtZSwgdGhpcyk7XG4gICAgICAgIHRoaXMudGltZXIgPSB0aGlzLmdhbWUuYWRkLnRleHQodGhpcy53b3JsZC5jZW50ZXJYLCAwLCBcIjYwXCIpO1xuICAgICAgICB0aGlzLnRpbWVyLmZpeGVkVG9DYW1lcmEgPSB0cnVlO1xuXG4gICAgICAgIHRoaXMudGltZXIuYW5jaG9yLnNldCgwLjUsIDApO1xuXG4gICAgICAgIC8vIERyb3AgYSBib29zdCBvbiB0aGUgbGV2ZWxcbiAgICAgICAgdGhpcy5ib29zdHMgPSB0aGlzLmFkZC5ncm91cCgpO1xuXG4gICAgICAgIHZhciBib29zdCA9IG5ldyBCb29zdCh0aGlzLmdhbWUsIDM2MC8yLCA2MDApO1xuXG4gICAgICAgIHRoaXMuYm9vc3RzLmFkZChib29zdCk7XG5cbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgLy8gc2Nyb2xsIHRoZSBzY3JlZW5cbiAgICAgICAgdGhpcy5jYW1lcmEueSArPSA2O1xuXG4gICAgICAgIHZhciB0aW1lTGVmdCA9IE1hdGguZmxvb3IodGhpcy5ydW5UaW1lci50aW1lci5kdXJhdGlvbiAvIDEwMDApO1xuICAgICAgICB2YXIgZGlzdGFuY2VMZWZ0ID0gdGhpcy5zdGFnZUxlbmd0aCAtIHRoaXMuY2FtZXJhLnkgLSA2NDA7XG5cbiAgICAgICAgdGhpcy50aW1lci5zZXRUZXh0KHRpbWVMZWZ0ICsgJyB8fCAnICsgZGlzdGFuY2VMZWZ0KTtcblxuICAgICAgICB0aGlzLnBoeXNpY3MuYXJjYWRlLmNvbGxpZGUodGhpcy5ydW5uZXIsIHRoaXMuZ3JhbW1hcyk7XG4gICAgICAgIHRoaXMucGh5c2ljcy5hcmNhZGUuY29sbGlkZSh0aGlzLnJ1bm5lciwgdGhpcy5ib29zdHMsIHRoaXMuY29sbGVjdEJvb3N0LCBudWxsLCB0aGlzKTtcblxuICAgICAgICB0aGlzLnJ1bm5lci5ib2R5LnZlbG9jaXR5LnggPSAwO1xuXG4gICAgICAgIC8vIEtleSBwcmVzcyB0byByaWdodFxuICAgICAgICBpZiAodGhpcy5pbnB1dC5rZXlib2FyZC5pc0Rvd24oUGhhc2VyLktleWJvYXJkLlJJR0hUKSkge1xuICAgICAgICAgICAgdGhpcy5ydW5uZXIuYm9keS52ZWxvY2l0eS54ID0gKyAzMDA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBLZXkgcHJlc3MgdG8gbGVmdFxuICAgICAgICBpZiAodGhpcy5pbnB1dC5rZXlib2FyZC5pc0Rvd24oUGhhc2VyLktleWJvYXJkLkxFRlQpKSB7XG4gICAgICAgICAgICB0aGlzLnJ1bm5lci5ib2R5LnZlbG9jaXR5LnggPSAtIDMwMDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ3JhbW1hcy5zb3J0KCd5JywgUGhhc2VyLkdyb3VwLlNPUlRfQVNDRU5ESU5HKTtcblxuICAgICAgICAvLyB0aGUgYW1tb3VudCBpcyBoYWx2ZWQgZHVlIHRvIHNjYWxpbmdcbiAgICAgICAgdGhpcy5sYW5kLnRpbGVQb3NpdGlvbi54ID0gLXRoaXMuY2FtZXJhLnggLyAyO1xuICAgICAgICB0aGlzLmxhbmQudGlsZVBvc2l0aW9uLnkgPSAtdGhpcy5jYW1lcmEueSAvIDI7XG5cbiAgICAgICAgaWYgKHRoaXMuY2FtZXJhLnkgPiB0aGlzLm5leHRHcmFtbWEpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkR3JhbW1hKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiBoZSBmYWxscyBiZWhpbmQgdG9vIG11Y2ggeW91IGxvc2VcbiAgICAgICAgaWYgKHRoaXMucnVubmVyLnBvc2l0aW9uLnkgPD0gdGhpcy5jYW1lcmEueSkge1xuICAgICAgICAgICAgdGhpcy5lbmRHYW1lKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBXaGVuIHlvdSBnZXQgdG8gdGhlIGVuZCB5b3Ugd2luXG4gICAgICAgIGlmIChkaXN0YW5jZUxlZnQgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5lbmRHYW1lKHRydWUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyB0aGlzLmdhbWUuZGVidWcuYm9keUluZm8odGhpcy5ydW5uZXIsIDMyLCAzMik7XG4gICAgICAgIC8vIHRoaXMuZ2FtZS5kZWJ1Zy5ib2R5KHRoaXMucnVubmVyLCAzMiwgMzIpO1xuICAgIH0sXG5cbiAgICBhZGRHcmFtbWE6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGdyYW1tYSA9IG5ldyBHcmFtbWEoXG4gICAgICAgICAgICB0aGlzLmdhbWUsXG4gICAgICAgICAgICBNYXRoLnJhbmRvbSgpICogMzYwLFxuICAgICAgICAgICAgdGhpcy5jYW1lcmEueSArIDY0MFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIHRoaXMuZ2FtZS5kZWJ1Zy5ib2R5KGdyYW1tYSk7XG4gICAgICAgIHRoaXMuZ3JhbW1hcy5hZGQoZ3JhbW1hKTtcbiAgICAgICAgdGhpcy5uZXh0R3JhbW1hKz0gMzIwO1xuICAgIH0sXG5cbiAgICBlbmRHYW1lOiBmdW5jdGlvbiAod2luKSB7XG4gICAgICAgIHZhciBzY29yZSA9IDA7XG5cbiAgICAgICAgaWYgKHdpbikge1xuICAgICAgICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdXaW4nKTtcbiAgICAgICAgICAgIHNjb3JlID0gTWF0aC5yb3VuZCh0aGlzLnRpbWUuZXZlbnRzLmR1cmF0aW9uIC8gMTAwKTtcbiAgICAgICAgICAgIHdpbmRvdy5wbGF5ZXJTdGF0ZS5zY29yZXMucHVzaChzY29yZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ0xvc2UnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb2xsZWN0Qm9vc3Q6IGZ1bmN0aW9uIChydW5uZXIsIGJvb3N0KSB7XG4gICAgICAgIGJvb3N0LmtpbGwoKTtcbiAgICAgICAgdGhpcy5ydW5uZXIuY29sbGVjdEJvb3N0KCk7XG4gICAgICAgIC8vIHRoaXMudGltZS5ldmVudHMuYWRkKFBoYXNlci5UaW1lci5TRUNPTkQgKiAxMCwgdGhpcy5ydW5uZXIuZW5kQm9vc3QpO1xuICAgIH1cbn07XG4iLCJ2YXIgTG9zZSA9IGZ1bmN0aW9uICgpIHtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTG9zZTtcblxuTG9zZS5wcm90b3R5cGUgPSB7XG4gICAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzdHlsZSA9IHtmb250OiBcIjI0cHggQXJpYWxcIiwgZmlsbDogXCIjZmZmZmZmXCIsIGFsaWduOiBcImNlbnRlclwifSxcbiAgICAgICAgICAgIHRleHQgPSB0aGlzLmFkZC50ZXh0KHRoaXMud29ybGQuY2VudGVyWCwgMjAwLCBcIllvdSBMb3NlXCIsIHN0eWxlKTtcblxuICAgICAgICB0ZXh0LmFuY2hvci5zZXQoMC41LCAwKTtcblxuICAgICAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xuICAgIH0sXG5cbiAgICBvbkRvd246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XG4gICAgfVxufTsiLCJ2YXIgTWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnRleHQgPSBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBNZW51O1xuXG5NZW51LnByb3RvdHlwZSA9IHtcblxuICAgIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc3R5bGUgPSB7Zm9udDogXCIyNHB4IEFyaWFsXCIsIGZpbGw6IFwiI2ZmZmZmZlwiLCBhbGlnbjogXCJjZW50ZXJcIn0sXG4gICAgICAgICAgICB0ZXh0ID0gdGhpcy5hZGQudGV4dCh0aGlzLndvcmxkLmNlbnRlclgsIDIwMCwgXCJQcmVzcyB0byBTdGFydFwiLCBzdHlsZSk7XG5cbiAgICAgICAgdGhpcy5zdGFnZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIiMwMDAwMDBcIjtcblxuICAgICAgICB0ZXh0LmFuY2hvci5zZXQoMC41LCAwKTtcblxuICAgICAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgb25Eb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydChwbGF5ZXJTdGF0ZS5jdXJyZW50TGV2ZWwpO1xuICAgICAgICAvLyB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ1dpbicpO1xuICAgIH1cbn07XG4iLCJ2YXIgUHJlbG9hZGVyID0gZnVuY3Rpb24gKGdhbWUpIHtcbiAgICB0aGlzLmFzc2V0ID0gbnVsbDtcbiAgICB0aGlzLnJlYWR5ID0gZmFsc2U7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFByZWxvYWRlcjtcblxuUHJlbG9hZGVyLnByb3RvdHlwZSA9IHtcblxuICAgIHByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5hc3NldCA9IHRoaXMuYWRkLnNwcml0ZSgzMjAsIDI0MCwgJ3ByZWxvYWRlcicpO1xuICAgICAgICB0aGlzLmFzc2V0LmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG5cbiAgICAgICAgdGhpcy5sb2FkLm9uTG9hZENvbXBsZXRlLmFkZE9uY2UodGhpcy5vbkxvYWRDb21wbGV0ZSwgdGhpcyk7XG4gICAgICAgIHRoaXMubG9hZC5zZXRQcmVsb2FkU3ByaXRlKHRoaXMuYXNzZXQpO1xuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoJ2Zsb29ydGlsZScsICdhc3NldHMvZmxvb3J0aWxlLnBuZycpO1xuICAgICAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ3J1bm5lcicsICdhc3NldHMvcnVubmVyLnBuZycsIDEyMCwgMTIwKTtcbiAgICAgICAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KCdncmFtbWEnLCAnYXNzZXRzL2dyYW1tYS5wbmcnLCAxMjAsIDEyMCk7XG5cbiAgICB9LFxuXG4gICAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuYXNzZXQuY3JvcEVuYWJsZWQgPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghIXRoaXMucmVhZHkpIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnTWVudScpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uTG9hZENvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucmVhZHkgPSB0cnVlO1xuICAgIH1cbn07XG4iLCJ2YXIgU2NvcmUgPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNjb3JlO1xuXG5TY29yZS5wcm90b3R5cGUgPSB7XG4gICAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG5cbiAgICB9XG59OyIsInZhciBTcGxhc2ggPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNwbGFzaDtcblxuU3BsYXNoLnByb3RvdHlwZSA9IHtcbiAgICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB9XG59OyIsInZhciBXaW4gPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFdpbjtcblxuV2luLnByb3RvdHlwZSA9IHtcbiAgICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGxhc3RTY29yZSA9IHdpbmRvdy5wbGF5ZXJTdGF0ZS5zY29yZXNbd2luZG93LnBsYXllclN0YXRlLnNjb3Jlcy5sZW5ndGgtMV0sXG4gICAgICAgICAgICBzdHlsZSA9IHtmb250OiBcIjI0cHggQXJpYWxcIiwgZmlsbDogXCIjZmZmZmZmXCIsIGFsaWduOiBcImNlbnRlclwifSxcbiAgICAgICAgICAgIHRleHQgPSB0aGlzLmFkZC50ZXh0KHRoaXMud29ybGQuY2VudGVyWCwgMjAwLCBcIllvdSB3aW4gXCIgKyBsYXN0U2NvcmUsIHN0eWxlKTtcblxuICAgICAgICB0ZXh0LmFuY2hvci5zZXQoMC41LCAwKTtcblxuICAgICAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xuICAgIH0sXG5cbiAgICBvbkRvd246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XG4gICAgfVxufTsiLCJ2YXIgVXRpbHMgPSB7XG4gICAgY29udGFpbnNPYmplY3Q6IGZ1bmN0aW9uIChvYmosIGxpc3QpIHtcbiAgICAgICAgdmFyIGk7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAobGlzdFtpXSA9PT0gb2JqKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBVdGlsczsiXX0=
